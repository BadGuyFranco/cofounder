name: Release to R2

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest
    name: Create release and upload to R2
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Create release zip
        run: |
          zip -r cofounder-latest.zip . \
            -x "*.git*" \
            -x ".github/*" \
            -x "*.DS_Store" \
            -x "__MACOSX/*"
          
          echo "Release contents:"
          unzip -l cofounder-latest.zip | tail -20
      
      - name: Install Wrangler
        run: npm install -g wrangler
      
      - name: Upload to R2
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: 14dede7d41cbeea1d7666cf6ffe4c133
        run: |
          echo "Uploading to R2..."
          wrangler r2 object put cofounder-releases/cofounder-latest.zip --file=cofounder-latest.zip --remote
